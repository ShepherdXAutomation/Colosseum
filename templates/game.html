<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Colosseum</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style>
       
        body {
            margin: 0;
            padding: 0;
            background-color: sienna;
            
        
        }
        game-container {
            width: 70vw;
            height: 100vh;
           
        }
        canvas {
            width: 70vw;
            height: 80vh;
            margin-top:5%;
            margin-left: 5%;
            margin: 5%;
        }

    </style>
</head>
<body>
<p>AI Chat Area</p>
<div id="game-container"></div>

<script type = "module">
    // Initialize Phaser configuration
    console.log("Game is starting"); // Simple test
    import { createAnimations, setupSoundEvents } from './static/js/anims.js';  // Import the animations
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        parent: 'game-container',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var player;
    var enemy;
    var cursors;

    // Preload assets
 // Preload assets
function preload() {
    this.load.image('background', '/static/images/background.png'); // Background
    this.load.spritesheet('character', 'static/images/universal-lpc-sprite_male_01_walk-3frame.png', {
        frameWidth: 43, 
        frameHeight: 61,
        margin: 7,
        horizontal: 4
    });
    this.load.audio('backgroundMusic', 'static/necromancers_tower.ogg');
    this.load.audio('whipSound', 'static/whip.wav');
    this.load.atlas('strongfairy', '/static/images/sprites/strongfairy-1.png', '/static/images/sprites/strongfairy-1.json');
   
}

// Create the game scene
function create() {
    // Add background
    const background = this.add.image(400, 300, 'background');
    const bottomLeft = getBottomLeftCorner(background);
    const bottomRight = getBottomRightCorner(background);

    // Play background music
    var music = this.sound.add('backgroundMusic', {
        loop: true
    });
    music.play();

 

    // Add player/enemy sprite and enable physics
    let player = this.physics.add.sprite(400, bottomLeft.y, 'character');
    let enemy = this.add.sprite(400, 150, 'strongfairy');

    // Create animations using imported function
    createAnimations(this);

    // Create sounds
       // Sounds
       var whipSound = this.sound.add('whipSound');
    const soundConfig = {
        'fairy-whip': {
            4: whipSound  // Play whip sound at frame 4
        }
        // Add more animations and frames as needed
    };
    setupSoundEvents(this, enemy, soundConfig);
    
    // Set bounce and collide with world bounds
    player.setBounce(0.2);
    player.setCollideWorldBounds(true);

    // Play animations
    player.anims.play('villager-walk');
    enemy.anims.play('fairy-walk-down');

    enemy.on('animationupdate', function (animation, frame) {
    if (animation.key === 'fairy-whip' && frame.index === 4) {
    whipSound.play();  // Play sound at frame 4
    }
    });

    // Tween logic remains the same
    this.tweens.add({
        targets: player,
        y: 450,
        ease: 'Linear',
        duration: 4000,
        repeat: 0,
        onComplete: function() {
            player.anims.play('idle');
        }
    });
    
    this.tweens.add({
        targets: enemy,
        y: 300,
        ease: 'Linear',
        duration: 4000,
        repeat: 0,
        onComplete: function() {
            enemy.anims.play('fairy-dance');
            enemy.scene.time.delayedCall(1000, function() {
                enemy.anims.play('fairy-whip');
                enemy.scene.time.delayedCall(1000, function() {
                    enemy.anims.play('fairy-idle');
                });
            });
        }
    });

    // Enable keyboard input
    cursors = this.input.keyboard.createCursorKeys();
}

    // Update loop for the game
    function update() {
        // Jump when pressing the space bar and on the ground
        if (cursors.space.isDown && player.body.touching.down) {
            player.setVelocityY(-330);
        }
    }

    // Start the Phaser game with the configuration
    var game = new Phaser.Game(config);


    // Function to get the bottom-left corner of the background image
function getBottomLeftCorner(background) {
    const x = background.x - background.displayWidth / 2;
    const y = background.y + background.displayHeight / 2;
    return { x, y };
}

// Function to get the x and y coordinates of the bottom-right corner of the background image
function getBottomRightCorner(background) {
    const x = background.x + background.displayWidth / 2;
    const y = background.y + background.displayHeight / 2;
    return { x, y };
}


</script>
<p>Player Chat Area</p>
</body>
</html>
